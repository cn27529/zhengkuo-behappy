# æ­£åœ‹å¯ºå»Ÿç®¡ç†ç³»çµ± - Nginx éƒ¨ç½²å¥—ä»¶

é€™å€‹å¥—ä»¶åŒ…å«äº†å°‡æ­£åœ‹å¯ºå»Ÿç®¡ç†ç³»çµ±éƒ¨ç½²åˆ°ç”Ÿç”¢ç’°å¢ƒæ‰€éœ€çš„æ‰€æœ‰é…ç½®æ–‡ä»¶å’Œè…³æœ¬ã€‚

## ğŸ“ æ–‡ä»¶èªªæ˜

| æ–‡ä»¶ | èªªæ˜ |
|------|------|
| `nginx-config.conf` | Nginx ä¸»é…ç½®æ–‡ä»¶ |
| `nginx-setup-guide.md` | å®Œæ•´çš„è¨­ç½®æŒ‡å— (å¿…è®€) |
| `docker-compose.yml` | Docker å®¹å™¨ç·¨æ’é…ç½® |
| `.env.example` | ç’°å¢ƒè®Šæ•¸ç¯„ä¾‹ |
| `quick-start.sh` | å¿«é€Ÿå•Ÿå‹•è…³æœ¬ |
| `README.md` | æœ¬æ–‡ä»¶ |

## ğŸš€ å¿«é€Ÿé–‹å§‹

### æ–¹æ¡ˆä¸€ï¼šå‚³çµ±éƒ¨ç½² (æ¨è–¦ç”Ÿç”¢ç’°å¢ƒ)

```bash
# 1. è¤‡è£½é…ç½®æ–‡ä»¶
sudo cp nginx-config.conf /etc/nginx/conf.d/zhengkuo-behappy.conf

# 2. ç·¨è¼¯åŸŸåè¨­ç½®
sudo nano /etc/nginx/conf.d/zhengkuo-behappy.conf
# å°‡ your-domain.com æ›¿æ›ç‚ºå¯¦éš›åŸŸå

# 3. ä½¿ç”¨å¿«é€Ÿå•Ÿå‹•è…³æœ¬
./quick-start.sh prod
```

### æ–¹æ¡ˆäºŒï¼šDocker éƒ¨ç½² (æ¨è–¦é–‹ç™¼/æ¸¬è©¦)

```bash
# 1. è¤‡è£½ç’°å¢ƒè®Šæ•¸
cp .env.example .env

# 2. ç·¨è¼¯é…ç½®
nano .env

# 3. å•Ÿå‹•å®¹å™¨
./quick-start.sh docker
```

### æ–¹æ¡ˆä¸‰ï¼šé–‹ç™¼ç’°å¢ƒ

```bash
# ç›´æ¥å•Ÿå‹•é–‹ç™¼ç’°å¢ƒ
./quick-start.sh dev
```

## ğŸ“– è©³ç´°æ–‡æª”

è«‹åƒé–± `nginx-setup-guide.md` ç²å–ï¼š

- å®Œæ•´çš„å®‰è£æ­¥é©Ÿ
- SSL è­‰æ›¸é…ç½®
- æœå‹™ç®¡ç†
- æ•…éšœæ’é™¤
- æ€§èƒ½å„ªåŒ–å»ºè­°

## âœ… éƒ¨ç½²å‰æª¢æŸ¥æ¸…å–®

- [ ] å·²å®‰è£ Nginx 1.18+
- [ ] å·²å®‰è£ Node.js 16+
- [ ] å·²å®‰è£ Rust 1.70+
- [ ] DNS è¨˜éŒ„å·²é…ç½®
- [ ] é˜²ç«ç‰†ç«¯å£å·²é–‹æ”¾ (80, 443)
- [ ] SSL è­‰æ›¸å·²æº–å‚™ (Let's Encrypt æˆ–å…¶ä»–)
- [ ] ç’°å¢ƒè®Šæ•¸å·²é…ç½®
- [ ] è³‡æ–™åº«æ–‡ä»¶å·²æº–å‚™

## ğŸ› ï¸ å¿«é€Ÿå‘½ä»¤

```bash
# å•Ÿå‹•é–‹ç™¼ç’°å¢ƒ
./quick-start.sh dev

# å•Ÿå‹•ç”Ÿç”¢ç’°å¢ƒ
./quick-start.sh prod

# å•Ÿå‹• Docker ç’°å¢ƒ
./quick-start.sh docker

# åœæ­¢æ‰€æœ‰æœå‹™
./quick-start.sh stop

# æŸ¥çœ‹æœå‹™ç‹€æ…‹
./quick-start.sh status

# æ¸¬è©¦ Nginx é…ç½®
sudo nginx -t

# é‡è¼‰ Nginx
sudo systemctl reload nginx

# æŸ¥çœ‹æ—¥èªŒ
sudo tail -f /var/log/nginx/zhengkuo-error.log
```

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Internet  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                    â”‚    Nginx    â”‚ :80, :443
                    â”‚  (åå‘ä»£ç†)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
   â”‚ Frontendâ”‚      â”‚   Rust    â”‚     â”‚   Logs    â”‚
   â”‚  :5173  â”‚      â”‚  Backend  â”‚     â”‚  Server   â”‚
   â”‚         â”‚      â”‚   :3000   â”‚     â”‚   :3002   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                    â”‚   SQLite    â”‚
                    â”‚  Database   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š æœå‹™ç«¯å£æ˜ å°„

| æœå‹™ | å…§éƒ¨ç«¯å£ | å¤–éƒ¨è¨ªå• |
|------|---------|---------|
| å‰ç«¯ | 5173 | / |
| Rust API | 3000 | /api/ |
| Directus | 8055 | /directus/ |
| æ—¥èªŒæœå‹™ | 3002 | /logs/ |
| æ–‡æª”æœå‹™ | 3001 | /docs/ |

## ğŸ”’ å®‰å…¨å»ºè­°

1. **ä½¿ç”¨ HTTPS**
   - é…ç½® Let's Encrypt SSL è­‰æ›¸
   - å•Ÿç”¨ HSTS

2. **é˜²ç«ç‰†è¨­ç½®**
   - åƒ…é–‹æ”¾å¿…è¦ç«¯å£ (80, 443)
   - é™åˆ¶ç›´æ¥è¨ªå•å¾Œç«¯ç«¯å£

3. **å®šæœŸæ›´æ–°**
   - ä¿æŒç³»çµ±å¥—ä»¶æœ€æ–°
   - æ›´æ–° SSL è­‰æ›¸

4. **å‚™ä»½ç­–ç•¥**
   - æ¯æ—¥è‡ªå‹•å‚™ä»½è³‡æ–™åº«
   - ä¿ç•™ 30 å¤©å‚™ä»½

## ğŸ› æ•…éšœæ’é™¤

### Nginx ç„¡æ³•å•Ÿå‹•
```bash
sudo nginx -t
sudo journalctl -u nginx -n 50
```

### 502 Bad Gateway
```bash
# æª¢æŸ¥å¾Œç«¯æœå‹™
./quick-start.sh status

# é‡å•Ÿå¾Œç«¯
./quick-start.sh stop
./quick-start.sh prod
```

### SSL è­‰æ›¸å•é¡Œ
```bash
sudo certbot renew
sudo certbot certificates
```

## ğŸ“ æ”¯æ´

å¦‚éœ€å¹«åŠ©ï¼Œè«‹ï¼š
1. æŸ¥é–± `nginx-setup-guide.md`
2. æª¢æŸ¥ç³»çµ±æ—¥èªŒ
3. è¯ç¹«æŠ€è¡“æ”¯æ´

## ğŸ“ æ›´æ–°æ—¥èªŒ

- **2024-02** - åˆå§‹ç‰ˆæœ¬
  - Nginx åå‘ä»£ç†é…ç½®
  - Docker æ”¯æ´
  - å¿«é€Ÿå•Ÿå‹•è…³æœ¬
  - å®Œæ•´è¨­ç½®æŒ‡å—

---

**License:** MIT  
**Author:** Zhengkuo Temple Management Team
