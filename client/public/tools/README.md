# 🔍 Method Diff Tool

## 📖 簡介

Method Diff Tool 是一個輕量級的代碼方法比對工具，用於快速分析和比較兩個 JavaScript/TypeScript 文件中的方法差異。

### ✨ 主要功能

- 🔎 **自動提取方法**：自動識別所有 async 和普通方法
- 📊 **視覺化對比**：清晰的表格展示，顏色編碼標識差異
- 📈 **統計分析**：自動計算方法總數、共同方法、差異方法
- 🎯 **精準定位**：快速找出缺失或新增的方法
- 💯 **零配置**：開箱即用，無需安裝依賴

---

## 🚀 快速開始

### 1. 訪問工具

在開發服務器運行時，訪問：

```
http://localhost:5173/tools/method-diff.html
```

### 2. 使用步驟

1. **貼上代碼**：將需要比對的兩個源代碼文件內容分別貼到左右文本框
2. **點擊比對**：點擊「🔎 開始比對」按鈕
3. **查看結果**：查看表格化的比對結果和統計摘要

---

## 📋 使用場景

### 場景 1: Service 接口一致性檢查

**用途**：確保 Directus Service 和 Rust Service 實現了相同的方法

```javascript
// 左側：activityService.js (Directus)
// 右側：rustActivityService.js (Rust)

// 比對結果會顯示：
// ✅ 兩邊都實現的方法
// ⚠️ 只在 Directus 中的方法（Rust 需要補充）
// 🦀 只在 Rust 中的方法（Rust 特有功能）
```

**實際應用**：

- 開發 Rust 後端時，確保 API 完整性
- 遷移過程中追蹤進度
- Code Review 時快速檢查

---

### 場景 2: Store 重構前後對比

**用途**：重構 Vuex/Pinia Store 時確保沒有遺漏方法

```javascript
// 左側：oldActivityStore.js
// 右側：newActivityStore.js

// 檢查點：
// ✅ 所有舊方法都有對應的新實現
// 📝 記錄被移除的方法（可能需要遷移指南）
// 🆕 新增的方法（需要更新文檔）
```

---

### 場景 3: API 版本升級

**用途**：比對 API v1 和 v2 的方法差異

```javascript
// 左側：userAPI_v1.js
// 右側：userAPI_v2.js

// 生成升級指南：
// ❌ v1 中被廢棄的方法
// ✅ v2 中保留的方法
// 🆕 v2 新增的方法
```

---

### 場景 4: 工具類/輔助函數審計

**用途**：重構工具類時確保功能完整性

```javascript
// 左側：utils/dateUtils.js
// 右側：utils/dateUtilsRefactored.js

// 確保：
// ✅ 所有工具方法都被保留或有替代方案
// 📝 方法重命名的映射關係
```

---

## 🎨 結果說明

### 表格顏色編碼

| 顏色          | 含義     | 說明                   |
| ------------- | -------- | ---------------------- |
| 🟢 **淡綠色** | 兩邊都有 | 方法在兩個文件中都存在 |
| 🟡 **淡黃色** | 只在左側 | 方法只在左側文件中存在 |
| 🔴 **淡紅色** | 只在右側 | 方法只在右側文件中存在 |

### 統計卡片

```
┌─────────────────┐  ┌─────────────────┐
│  Directus: 25   │  │    Rust: 30     │
│   方法總數      │  │   方法總數      │
└─────────────────┘  └─────────────────┘

┌─────────────────┐  ┌─────────────────┐
│   共同: 20      │  │   差異: 10      │
│  ✅ 兩邊都有   │  │  ⚠️ 需要關注   │
└─────────────────┘  └─────────────────┘
```

### 表格結構

```
┌────────────────────────┬────────────────────────┬────────┐
│   📄 Directus Service  │   🦀 Rust Service      │  狀態  │
├────────────────────────┼────────────────────────┼────────┤
│  createActivity        │  createActivity        │   ✅   │
│  updateActivity        │  updateActivity        │   ✅   │
│  deleteActivity        │  —                     │   📄   │
│  —                     │  batchOperations       │   🦀   │
└────────────────────────┴────────────────────────┴────────┘
```

---

## 📊 統計摘要解讀

工具會在底部顯示詳細統計：

```markdown
📊 統計摘要
• ✅ 20 個方法在兩個 Service 中都存在
• 📄 5 個方法只在 Directus 中存在
• 🦀 10 個方法只在 Rust 中存在
• 📈 方法覆蓋率: 67%
```

### 覆蓋率計算

```
覆蓋率 = (共同方法數 / 總方法數) × 100%
       = (20 / 30) × 100%
       = 67%
```

**解讀**：

- **100%** = 完全一致
- **80%+** = 高度一致，少量差異
- **60-80%** = 部分一致，需要關注差異
- **<60%** = 差異較大，可能需要重新檢視

---

## 💡 最佳實踐

### 1. 開發階段

**情境**：正在開發 Rust 後端，需要確保與 Directus Service 接口一致

```bash
# 步驟
1. 複製 activityService.js 的完整代碼
2. 複製 rustActivityService.js 的完整代碼
3. 執行比對
4. 根據結果補充缺失的方法
5. 重複檢查直到覆蓋率達標
```

**目標**：覆蓋率 ≥ 90%（允許少量 Rust 特有的優化方法）

---

### 2. Code Review 階段

**情境**：PR 中修改了 Service，需要確認接口完整性

```bash
# Review 清單
□ 檢查是否有方法被意外刪除
□ 新增的方法是否有文檔
□ 方法命名是否一致
□ 參數是否對齊（需人工檢查）
```

---

### 3. 重構階段

**情境**：重構 Store，需要確保不遺漏功能

```bash
# 重構前
1. 運行 method-diff，記錄所有方法
2. 保存比對結果作為基準

# 重構中
3. 定期比對，追蹤進度

# 重構後
4. 最終比對，確保 100% 覆蓋或有明確的替代方案
```

---

### 4. API 遷移階段

**情境**：從 v1 遷移到 v2

```bash
# 生成遷移文檔
1. 比對 v1 和 v2
2. 記錄：
   • 廢棄的方法 → 提供替代方案
   • 重命名的方法 → 建立映射表
   • 新增的方法 → 撰寫使用說明
```

---

## 🔧 進階用法

### 技巧 1: 快速訪問

在項目中添加快捷鍵：

```javascript
// vite.config.js
export default {
  server: {
    open: "/tools/method-diff.html", // 啟動時自動打開
  },
};
```

---

### 技巧 2: 集成到 CI/CD

可以將比對結果納入持續集成流程：

```bash
# 使用腳本自動化比對
node scripts/check-method-consistency.js
```

---

### 技巧 3: 生成報告

複製比對結果到 Markdown：

```markdown
## Service 方法比對報告

**日期**: 2025-01-06
**比對對象**: activityService.js vs rustActivityService.js

### 結果

- 共同方法: 20
- Directus 獨有: 5
- Rust 獨有: 10
- 覆蓋率: 67%

### 待辦事項

- [ ] 補充 Rust 中缺失的 5 個方法
- [ ] 確認 Rust 特有的 10 個方法是否必要
```

---

## ⚠️ 注意事項

### 1. 工具限制

- ✅ 只檢測**方法名稱**，不檢測參數和返回值
- ✅ 不執行代碼，只做文本分析
- ✅ 需要人工確認方法的**功能是否一致**

### 2. 不適用場景

❌ **參數類型檢查**：無法檢測參數類型差異

```javascript
// 這兩個方法會被認為是相同的
createActivity(data); // Directus
createActivity(data, context); // Rust (參數不同)
```

❌ **返回值檢查**：無法檢測返回值差異

```javascript
// 這兩個方法會被認為是相同的
async getActivity(): Activity          // TypeScript
async getActivity(): Promise<void>     // 返回值不同
```

❌ **方法實現檢查**：無法檢測方法內部邏輯

```javascript
// 即使實現完全不同，只要方法名一樣就會標記為相同
```

### 3. 建議配合使用

- 📝 **人工 Code Review**：確認方法功能一致性
- 🧪 **單元測試**：確保方法行為正確
- 📖 **API 文檔**：記錄參數和返回值
- 🔍 **TypeScript**：利用類型系統做編譯時檢查

---

## 🛠️ 故障排除

### 問題 1: 無法訪問工具頁面

**症狀**：訪問 `/tools/method-diff.html` 顯示 404

**解決方案**：

```bash
# 確認文件位置
ls public/tools/method-diff.html

# 確認開發服務器正在運行
npm run dev

# 確認端口號
# Vite 默認: 5173
# Vue CLI 默認: 3002
# CRA 默認: 3000
```

---

### 問題 2: 方法沒有被識別

**症狀**：某些方法沒有出現在比對結果中

**可能原因**：

1. 方法名以下劃線開頭（被過濾）
2. 不是標準的方法定義格式
3. 在註解中的代碼

**解決方案**：

```javascript
// ✅ 會被識別
async methodName() { }
methodName() { }

// ❌ 不會被識別
_privateMethod() { }          // 私有方法
constructor() { }             // 構造函數
const method = function() {}  // 某些函數表達式
```

---

### 問題 3: 結果不準確

**症狀**：比對結果與預期不符

**檢查清單**：

- [ ] 確認貼入了完整的代碼（沒有截斷）
- [ ] 確認沒有貼入註解中的示例代碼
- [ ] 確認方法定義符合標準格式
- [ ] 清空並重新貼入代碼

---

## 📚 相關資源

### 項目文檔

- [Service 架構說明](../docs/service-architecture.md)
- [API 接口規範](../docs/api-specification.md)
- [開發指南](../docs/development-guide.md)

### 相關工具

- `api-tester.html` - API 測試工具（規劃中）
- `type-checker.html` - 類型檢查工具（規劃中）

---

## 🤝 貢獻與反饋

### 報告問題

如果發現工具有問題或建議改進，請：

1. 在團隊會議上提出
2. 發送郵件到開發團隊
3. 在項目 Issue 中記錄

### 功能建議

歡迎提出新功能建議：

- 參數數量比對
- 返回值類型檢查（TypeScript）
- 導出比對報告（PDF/Markdown）
- 批量比對多個文件

---

## 📝 更新日誌

### v1.0.0 (2025-01-06)

- ✨ 初始版本發布
- 🎨 表格化展示比對結果
- 📊 統計分析功能
- 🎯 顏色編碼識別差異

---

## 📄 授權

本工具為項目內部開發工具，僅供團隊內部使用。

---

## 👥 維護者

- 開發團隊
- 最後更新：2025-01-06

---

**Happy Coding! 🚀**
